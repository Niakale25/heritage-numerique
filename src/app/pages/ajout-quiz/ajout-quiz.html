<div class="ajout-quiz-container">
  <h2 class="page-title">Création d’un nouveau Quiz</h2>

  <!-- Sélection du conte -->
  <div class="form-section">
    <label for="conte-select" class="form-label">Associer le quiz à un conte :</label>
    <div class="custom-select-container">
      <select id="conte-select" class="conte-select-input" [(ngModel)]="selectedConteId" name="conteSelect">
        <option [ngValue]="null" disabled>-- Sélectionnez un conte --</option>
        <option *ngFor="let conte of contes" [ngValue]="conte.id">{{ conte.titre }}</option>
      </select>
      <i class="material-icons select-arrow">keyboard_arrow_down</i>
    </div>
  </div>

  <!-- Infos générales -->
  <div class="form-section">
    <label class="form-label">Titre du quiz :</label>
    <input type="text" [(ngModel)]="currentQuiz.titre" name="titre" placeholder="Entrez le titre du quiz" class="form-input">

    <label class="form-label">Description :</label>
    <textarea [(ngModel)]="currentQuiz.description" name="description" placeholder="Description du quiz..." class="form-textarea"></textarea>
  </div>

  <hr>

  <!-- Section questions -->
  <div class="questions-section">
    <h3>Questions du quiz</h3>

    <div *ngFor="let question of currentQuiz.questions; let i = index" class="question-block">
      <h4>Question {{ i + 1 }}</h4>

      <label>Texte de la question :</label>
      <input type="text" [(ngModel)]="question.texteQuestion" name="texteQuestion-{{i}}" placeholder="Ex: Que fait le lion ?" class="form-input">

      <label>Type de question :</label>
      <select [(ngModel)]="question.typeReponse" (change)="setQuestionType(question.typeReponse, question)" name="typeQuestion-{{i}}" class="form-input">
        <option value="QCM">QCM</option>
        <option value="VRAI_FAUX">Vrai / Faux</option>
      </select>

      <label>Nombre de points :</label>
      <input type="number" [(ngModel)]="question.points" name="points-{{i}}" min="1" class="form-input-small">

      <!-- Propositions -->
      <div class="propositions-section">
        <h5>Propositions :</h5>

        <div *ngFor="let prop of question.propositions; let j = index" class="proposition-item">
          <input
            type="text"
            [(ngModel)]="prop.texteProposition"
            name="prop-{{i}}-{{j}}"
            [readonly]="question.typeReponse === 'VRAI_FAUX'"
            placeholder="Texte de la proposition"
            class="form-input-inline"
          >
          <label class="checkbox-label">
            <input type="checkbox" [(ngModel)]="prop.estCorrecte" name="propCorrect-{{i}}-{{j}}"> Bonne réponse
          </label>
          <button type="button" class="btn-remove" (click)="removeProposition(question, j)" *ngIf="question.typeReponse === 'QCM'">❌</button>
        </div>

        <!-- Bouton ajout proposition -->
        <button type="button" class="btn-add" (click)="addProposition(question)" *ngIf="question.typeReponse === 'QCM'">
           Ajouter une proposition
        </button>
      </div>

      <!-- Supprimer question -->
      <button type="button" class="btn-remove-question" (click)="removeQuestion(i)"> Supprimer cette question</button>

      <hr>
    </div>

    <button type="button" class="btn-add-question" (click)="addQuestion()"> Ajouter une question</button>
  </div>

  <!-- Validation -->
  <div class="submit-section">
    <button class="btn-validate" (click)="validateQuiz()"> Valider le quiz</button>
  </div>
</div>
